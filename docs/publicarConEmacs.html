<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cómo publicar sitios web estáticos con Emacs</title>
<meta name="author" content="Juan E. Gómez-Morantes" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "all"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content" class="content">
<header>
<h1 class="title">Cómo publicar sitios web estáticos con Emacs</h1>
</header>
<div id="outline-container-orgb89fd80" class="outline-2">
<h2 id="orgb89fd80">Introducción</h2>
<div class="outline-text-2" id="text-orgb89fd80">
<p>
Esta nota muestra cómo crear un sitio web estático usando Emacs que pueda ser publicado en servicios como <a href="http://github.io">http://github.io</a>.
</p>

<p>
Está inspirado y basado en una <a href="https://systemcrafters.net/publishing-websites-with-org-mode/building-the-site/">guía similar</a> desarrollada por David Wilson y hace constante referencia a los manuales de Emacs y <code>org-mode</code>.
</p>
</div>
</div>

<div id="outline-container-org5f63700" class="outline-2">
<h2 id="org5f63700">¿Por qué un sitio web estático?</h2>
<div class="outline-text-2" id="text-org5f63700">
<p>
Cualquiera que esté pensando en publicar un sitio web sencillo pensaría en primera instancia en usar en servicio de publicación como wordpress.com o blogger.com. Sin embargo, estos servicios, a mi parecer, se pueden convertir rápidamente en una camisa de fuerza que nos impida hacer cosas que queremos hacer (como controlar completamente el CSS de nuestro sitio), o que nos obligue a hacer cosas que no queremos hacer (como mostrar publicidad o vulnerar la privacidad de nuestros lectores). En adición, el valor agregado es muy poco si lo que queremos hacer es un sitio sencillo y sin contenido activo o interactivo.
</p>

<p>
Los sitios web estáticos, en cambio, son conjuntos de archivos hmtl sobre los que tenemos absoluto control y que se publican en servicios como <a href="http://github.io">http://github.io</a>. Al ser archivos estáticos, y servicios sin capacidades de almacenamiento o procesamiento, lo que publiquemos es lo que es; no hay forma de enriquecer o modificar el contenido con comentarios, posts de usuarios o contenido interactivo. 
</p>
</div>
</div>

<div id="outline-container-org64096a0" class="outline-2">
<h2 id="org64096a0">Inicio</h2>
<div class="outline-text-2" id="text-org64096a0">
<p>
Lo primero que tenemos que hacer para crear y publicar nuestro sitio web es crear una carpeta en donde tengamos un conjunto de archivos <code>.org</code> que serán luego exportados a archivos <code>.html</code> y conformarán nuestro sitio web. Es muy importante tener uno llamado <code>index.org</code> porque éste va a servir como página inicial de nuestro sitio web. También hay que tener en cuenta que para crear enlaces entre las páginas de nuestro sitio web lo único que tenemos que hacer es crear enlaces entre los archivos <code>.org</code> fuentes teniendo cuidado de que las rutas sean relativas.  
</p>

<p>
En adición, esta carpeta va a tener algunos archivos de gestión como <i>scripts</i> de elisp o configuraciones de Emacs para gestionar la generación y publicación de sitios web. Por ahora, la carpeta de nuestro sitio web se ve así:
</p>

<pre class="example">
.
└── index.org

0 directories, 1 file
</pre>
</div>
</div>

<div id="outline-container-org7edfad4" class="outline-2">
<h2 id="org7edfad4">Exportando el sitio web</h2>
<div class="outline-text-2" id="text-org7edfad4">
<p>
Existen muchas formas de exportar nuestros archivos <code>.org</code> a <code>.html</code>. La primera consiste en usar el <code>M-x org-export-dispatch</code> en cada uno de los archivos. Si bien esto nos da un control preciso de lo que estamos haciendo, es supremamente inconveniente y lento. Otra opción consiste en crear una función en elisp que recorra todos los archivos <code>.org</code> en nuestra carpeta y ejecute <code>M-x org-html-export-to-html</code> en cada uno de ellos. Sin embargo, como casi siempre en el mundo de emacs, este problema ya fue resuelto por alguien más, y esa solución se llama <a href="https://orgmode.org/manual/Publishing.html"><code>org-publish</code></a>.
</p>

<p>
<code>org-publish</code> es un sistema de publicación de sitios web estáticos que entiende una carpeta como un proyecto. Tiene funcionalidades para configurar plantillas, configuraciones comunes de generación y publicación automática a servidores en línea. Toma en cuenta archivos no-org (imágenes, pdf, etc.) y funciona de forma recursiva (i.e. en todas las sub-carpetas incluidas en la carpeta principal del proyecto). Al funcionar por carpetas que representan proyectos, resulta conveniente crear dos carpetas nuevas en nuestro proyecto; una para los archivos fuentes <code>.org</code> y otra llamada <code>docs</code><sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup> en donde va a queda nuestro sitio web completo con todos los archivos <code>.html</code> listos para publicación.
</p>

<p>
Las carpeta de nuestro proyecto ahora se ve así:
</p>

<pre class="example">
.
├── contenido
│   └── index.org
└── docs

2 directories, 1 file
</pre>


<p>
La definición de los proyectos tomados en cuenta por <code>org-publish</code> se hace con la variable <code>org-publish-project-alist</code> de la siguiente manera:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">setq</span> org-publish-project-alist
      <span style="color: #ff62d4;">(</span>list
       <span style="color: #3fdfd0;">(</span>list <span style="color: #79a8ff;">"verborrea"</span>
             <span style="color: #f78fe7;">:recursive</span> t
             <span style="color: #f78fe7;">:base-directory</span> <span style="color: #79a8ff;">"/ruta/a/carpeta/contenido"</span>
             <span style="color: #f78fe7;">:publishing-directory</span> <span style="color: #79a8ff;">"/ruta/a/carpeta/docs"</span>
             <span style="color: #f78fe7;">:publishing-function</span> 'org-html-publish-to-html<span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
Una vez registrado el proyecto, lo único que tenemos que hacer es llamar <code>M-x org-publish</code> desde emacs y especificar el nombre de nuestro proyecto para que se ejecute la publicación. También podemos llamar <code>M-x org-publish-all</code> para generar todos los sitios web que tengamos registrados en <code>org-publish-project-alist</code>.
</p>

<p>
Ejecutando <code>org-publish</code> en nuestro proyecto ejemplo, llegamos a la siguiente estructura de archivos:
</p>

<pre class="example">
.
├── contenido
│   └── index.org
└── docs
    └── index.html

2 directories, 2 files
</pre>
</div>
</div>

<div id="outline-container-org2f453d2" class="outline-2">
<h2 id="org2f453d2">Prueba y visualización</h2>
<div class="outline-text-2" id="text-org2f453d2">
<p>
Si bien se pueden ver los archivos <code>.html</code> de forma individual usando cualquier explorador web, existe una mejor forma de probar nuestro sitio web como se vería una vez publicado en un servidor web, y nos la permite el paquete <code>simple-httpd</code> de Emacs. Una vez instalemos <code>simple-httpd</code> en emacs, se puede ejecutar <code>M-x httpd-serve-directory</code> especificando la ruta a nuestro directorio <code>docs</code>. Luego, desde un navegador web, nos dirigimos a localhost:8080 y veremos nuestro sitio web completo.
</p>
</div>
</div>

<div id="outline-container-orgd574112" class="outline-2">
<h2 id="orgd574112">Configuración avanzada con <code>org-publish</code></h2>
<div class="outline-text-2" id="text-orgd574112">
<p>
Una de las ventajas de usar <code>org-publish</code> es que permite configurar opciones de exportación que se aplican de forma consistente a todos las páginas del sitio web. Esto es fabuloso porque, si queremos cambiar algún aspecto de esta configuración, sólo tenemos que hacerlo en la definición del proyecto y no en cada uno de los archivos que componen el sitio web. La siguiente definición, por ejemplo, publica todas las páginas de nuestro sitio web sin tabla de contenido, sin especificar que se creó con Emacs, sin numeración de secciones, y sin fecha y hora de creación. 
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">setq</span> org-publish-project-alist
      <span style="color: #ff62d4;">(</span>list
       <span style="color: #3fdfd0;">(</span>list <span style="color: #79a8ff;">"verborrea"</span>
             <span style="color: #f78fe7;">:recursive</span> t
             <span style="color: #f78fe7;">:base-directory</span> <span style="color: #79a8ff;">"/ruta/a/carpeta/contenido"</span>
             <span style="color: #f78fe7;">:publishing-directory</span> <span style="color: #79a8ff;">"/ruta/a/carpeta/docs"</span>
             <span style="color: #f78fe7;">:publishing-function</span> 'org-html-publish-to-html
             <span style="color: #f78fe7;">:with-author</span> nil
             <span style="color: #f78fe7;">:with-creator</span> t
             <span style="color: #f78fe7;">:with-toc</span> t 
             <span style="color: #f78fe7;">:section-numbers</span> nil
             <span style="color: #f78fe7;">:time-stamp-file</span> nil<span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
Sin embargo, a este punto, resulta inconveniente tener la definición del proyecto <code>org-publish</code> en un archivo de configuración de Emacs y separado de la carpeta del proyecto. Para resolver esto, vamos a crear un archivo llamado <code>.dir-locals.el</code> en la carpeta raíz del proyecto. Este archivo nos permitirá definir una variable local que aplica para todos los archivos que estén dentro de esta carpeta. El contenido de ese archivo es:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #ffffff;">(</span><span style="color: #ff62d4;">(</span>nil . <span style="color: #3fdfd0;">(</span><span style="color: #fba849;">(</span>eval . <span style="color: #9f80ff;">(</span><span style="color: #b6a0ff;">setq</span> org-publish-project-alist
                       <span style="color: #4fe42f;">(</span>list
                        <span style="color: #fe6060;">(</span>list <span style="color: #79a8ff;">"verborrea"</span>
                              <span style="color: #f78fe7;">:recursive</span> t
                              <span style="color: #f78fe7;">:base-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"contenido"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:publishing-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"docs"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:publishing-function</span> 'org-html-publish-to-html
                              <span style="color: #f78fe7;">:with-author</span> nil
                              <span style="color: #f78fe7;">:with-creator</span> t
                              <span style="color: #f78fe7;">:with-toc</span> t 
                              <span style="color: #f78fe7;">:section-numbers</span> nil<span style="color: #fe6060;">)</span><span style="color: #4fe42f;">)</span><span style="color: #9f80ff;">)</span><span style="color: #fba849;">)</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
Ahora, siempre que ejecutemos <code>M-x org-publish-all</code> desde un <i>buffer</i> que apunte a cualquier archivo dentro de la carpeta de nuestro proyecto, se generará nuestro sitio web. 
</p>

<p>
En adición, esto trae la ventaja de que ahora la configuración de exportación es parte de nuestro proyecto. Siendo así, si queremos gestionarlo con cualquier sistema de versionamiento (e.g. git), también incluiremos esta definición. Un punto importante a notar es que la forma de definición de carpetas para contenido y publicación depende de <a href="https://projectile.mx/"><code>projectile</code></a>, lo que implica que nuestro proyecto debe (a) estar en un repositorio de versionamiento como git o (b) tener un archivo <code>.projectile</code> (que puede estar vacío) en su carpeta raíz. Se podría poner la ruta completa a las carpetas de contenido y publicación, pero hacerlo con <code>projectile</code> garantiza que podamos mover la carpeta del proyecto sin necesidad de actualizar esta configuración; desacoplamos la exportación del proyecto de nuestra estructura de carpetas.
</p>

<p>
Con esto, nuestra carpeta raíz se ve así:
</p>

<pre class="example">
.
├── contenido
│   └── index.org
├── .dir-locals.el
├── docs
│   └── index.html
└── .git

2 directories, 4 files
</pre>


<p>
Las opciones de configuración de proyecto de <code>org-publish</code> son muchas y están cubiertas en su respectivo <a href="https://orgmode.org/manual/Publishing.html">manual</a>.
</p>
</div>
</div>

<div id="outline-container-org52db356" class="outline-2">
<h2 id="org52db356">Mejorando el aspecto visual</h2>
<div class="outline-text-2" id="text-org52db356">
<p>
Si usted ya generó sus primeras páginas con esta configuración, notará que es muy básica y de (muy) &laquo;vieja escuela&raquo;. Para mejorar esto sin necesidad de conocimientos o trabajo en <code>CSS</code> o <code>js</code>, podemos apoyarnos en plantillas de estilo pre-definidas como <a href="https://simplecss.org/">Simple.css</a> o <a href="https://github.com/fniessen/org-html-themes">ReadTheOrg</a>. Para esto, sólo tenemos que incluir la información necesaria de cada uno de estas plantillas en nuestra configuración de proyecto. Esto, y algunas otras mejoras, se configuran en los siguientes bloques.
</p>

<p>
Para Simple.css:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #ffffff;">(</span><span style="color: #ff62d4;">(</span>nil . <span style="color: #3fdfd0;">(</span><span style="color: #fba849;">(</span>eval . <span style="color: #9f80ff;">(</span><span style="color: #b6a0ff;">setq</span> org-publish-project-alist 
                       <span style="color: #4fe42f;">(</span>list
                        <span style="color: #fe6060;">(</span>list <span style="color: #79a8ff;">"verborrea"</span>
                              <span style="color: #f78fe7;">:recursive</span> t
                              <span style="color: #f78fe7;">:base-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"contenido"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:publishing-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"docs"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:publishing-function</span> 'org-html-publish-to-html
                              <span style="color: #f78fe7;">:with-author</span> t
                              <span style="color: #f78fe7;">:with-creator</span> t
                              <span style="color: #f78fe7;">:with-toc</span> nil
                              <span style="color: #f78fe7;">:time-stamp-file</span> nil
                              <span style="color: #f78fe7;">:html-validation-link</span> nil
                              <span style="color: #f78fe7;">:html-link-home</span> <span style="color: #79a8ff;">"index.html"</span>
                              <span style="color: #f78fe7;">:html-head-include-default-style</span> nil
                              <span style="color: #f78fe7;">:html-head-include-scripts</span> nil
                              <span style="color: #f78fe7;">:html-head</span> <span style="color: #79a8ff;">"&lt;link rel=\"stylesheet\" href=\"https://cdn.simplecss.org/simple.min.css\" /&gt;"</span>
                              <span style="color: #f78fe7;">:section-numbers</span> nil<span style="color: #fe6060;">)</span><span style="color: #4fe42f;">)</span><span style="color: #9f80ff;">)</span><span style="color: #fba849;">)</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>

</pre>
</div>

<p>
Para ReadTheOrg:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #ffffff;">(</span><span style="color: #ff62d4;">(</span>nil . <span style="color: #3fdfd0;">(</span><span style="color: #fba849;">(</span>eval . <span style="color: #9f80ff;">(</span><span style="color: #b6a0ff;">setq</span> org-publish-project-alist
                       <span style="color: #4fe42f;">(</span>list
                        <span style="color: #fe6060;">(</span>list <span style="color: #79a8ff;">"verborrea"</span>
                              <span style="color: #f78fe7;">:recursive</span> t
                              <span style="color: #f78fe7;">:base-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"contenido"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:publishing-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"docs"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:publishing-function</span> 'org-html-publish-to-html
                              <span style="color: #f78fe7;">:with-author</span> t
                              <span style="color: #f78fe7;">:with-creator</span> t
                              <span style="color: #f78fe7;">:with-toc</span> t
                              <span style="color: #f78fe7;">:time-stamp-file</span> nil
                              <span style="color: #f78fe7;">:html-validation-link</span> nil
                              <span style="color: #f78fe7;">:html-link-home</span> <span style="color: #79a8ff;">"index.html"</span>
                              <span style="color: #f78fe7;">:html-head-include-default-style</span> nil
                              <span style="color: #f78fe7;">:html-head-include-scripts</span> nil
                              <span style="color: #f78fe7;">:html-head</span> <span style="color: #79a8ff;">"&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css\"/&gt;\n&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css\"/&gt;&lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js\"&gt;&lt;/script&gt;&lt;script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js\"&gt;&lt;/script&gt;&lt;script type=\"text/javascript\" src=\"https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js\"&gt;&lt;/script&gt;&lt;script type=\"text/javascript\" src=\"https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js\"&gt;&lt;/script&gt;"</span>
                              <span style="color: #f78fe7;">:section-numbers</span> nil<span style="color: #fe6060;">)</span><span style="color: #4fe42f;">)</span><span style="color: #9f80ff;">)</span><span style="color: #fba849;">)</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1168348" class="outline-2">
<h2 id="org1168348">Inclusión de imágenes</h2>
<div class="outline-text-2" id="text-org1168348">
</div>
<div id="outline-container-org8b251e0" class="outline-3">
<h3 id="org8b251e0">Imágenes desde archivos</h3>
<div class="outline-text-3" id="text-org8b251e0">
<p>
El primer tipo de imágenes que vamos a incluir son imágenes desde archivos multimedia como archivos <code>.jpg</code> o <code>.png</code>. Estas imágenes son fáciles de manejar ya que lo único que tenemos que hacer es ubicarlas en una carpeta que esté dentro de la carpeta en donde tenemos los archivos <code>.org</code> a partir de los cuales se genera nuestro sitio web, y crear un enlace apuntando a la imagen. Por ejemplo, en la siguiente estructura de archivos:
</p>

<pre class="example">
.
├── contenido
│   ├── index.org
│   └── media
│       └── nasa.jpg
└── docs

3 directories, 2 files
</pre>


<p>
el enlace:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #00bcff; text-decoration: underline;"><a href="file:media/nasa.jpg">file:media/nasa.jpg</a></span>
</pre>
</div>

<p>
Nos mostrará la siguiente imagen. 
</p>


<figure id="org75d8e63">
<img src="media/nasa.jpg" alt="nasa.jpg">

</figure>

<p>
Para que esto funcione y sea fácil de exportar, tenemos que completar un poco nuestra configuración de <code>org-publish-project-alist</code> en el archivo <code>.dir-locals.el</code> para que quede de esta forma:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #ffffff;">(</span><span style="color: #ff62d4;">(</span>nil . <span style="color: #3fdfd0;">(</span><span style="color: #fba849;">(</span>eval . <span style="color: #9f80ff;">(</span><span style="color: #b6a0ff;">setq</span> org-publish-project-alist
                       <span style="color: #4fe42f;">(</span>list
                        <span style="color: #fe6060;">(</span>list <span style="color: #79a8ff;">"verborrea-org"</span>
                              <span style="color: #f78fe7;">:recursive</span> t
                              <span style="color: #f78fe7;">:base-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"contenido"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:publishing-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"docs"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:publishing-function</span> 'org-html-publish-to-html
                              <span style="color: #f78fe7;">:with-author</span> t
                              <span style="color: #f78fe7;">:with-creator</span> t
                              <span style="color: #f78fe7;">:with-toc</span> nil
                              <span style="color: #f78fe7;">:time-stamp-file</span> nil
                              <span style="color: #f78fe7;">:html-validation-link</span> nil
                              <span style="color: #f78fe7;">:html-link-home</span> <span style="color: #79a8ff;">"index.html"</span>
                              <span style="color: #f78fe7;">:html-head-include-default-style</span> nil
                              <span style="color: #f78fe7;">:html-head-include-scripts</span> nil
                              <span style="color: #f78fe7;">:html-head</span> <span style="color: #79a8ff;">"&lt;link rel=\"stylesheet\" href=\"https://cdn.simplecss.org/simple.min.css\" /&gt;"</span>
                              <span style="color: #f78fe7;">:section-numbers</span> nil<span style="color: #fe6060;">)</span>
                        <span style="color: #fe6060;">(</span>list <span style="color: #79a8ff;">"verborrea-img"</span>
                              <span style="color: #f78fe7;">:base-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"contenido/media"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:base-extension</span> <span style="color: #79a8ff;">"png</span><span style="color: #abab00; font-weight: bold;">\\</span><span style="color: #e7a59a; font-weight: bold;">|</span><span style="color: #79a8ff;">jpg</span><span style="color: #abab00; font-weight: bold;">\\</span><span style="color: #e7a59a; font-weight: bold;">|</span><span style="color: #79a8ff;">gif"</span>
                              <span style="color: #f78fe7;">:publishing-function</span> 'org-publish-attachment
                              <span style="color: #f78fe7;">:publishing-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"docs/media"</span><span style="color: #4fafff;">)</span><span style="color: #fe6060;">)</span>
                        <span style="color: #fe6060;">(</span>list <span style="color: #79a8ff;">"verborrea"</span>
                              <span style="color: #f78fe7;">:components</span> '<span style="color: #4fafff;">(</span><span style="color: #79a8ff;">"verborrea-org"</span> <span style="color: #79a8ff;">"verborrea-img"</span><span style="color: #4fafff;">)</span><span style="color: #fe6060;">)</span><span style="color: #4fe42f;">)</span><span style="color: #9f80ff;">)</span><span style="color: #fba849;">)</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
Lo que hicimos acá fue crear dos registro nuevos; uno para la carpeta de imágenes de nuestro sitio web y otro para el proyecto completo. El registro para la carpeta de imágenes define la carpeta fuente y la carpeta destino de las imágenes, y usa <code>org-publish-attachment</code> como función de publicación. Esto lo que hace es simplemente copiar los archivos que coincidan con el filtro definido en <code>base-extensions</code> desde la carpeta fuente a la carpeta destino. 
</p>

<p>
Nuestra carpeta de proyecto se verá así luego de llamar <code>M-x org-publish-all</code>:
</p>
<pre class="example" id="orgbc0a681">
.
├── contenido
│   ├── index.org
│   └── media
│       └── nasa.jpg
└── docs
    ├── index.html
    └── media
        └── nasa.jpg

4 directories, 4 files
</pre>

<p>
Un punto molesto es que hacerlo así implica duplicar nuestras imágenes, lo que consume más espacio en disco. Sin embargo, hacerlo de otra forma puede acarrear problemas con las rutas de los enlaces y que las imágenes no se muestren bien al generar nuestro sitio web. Por ahora, es lo mejor que podemos hacer. 
</p>
</div>
</div>

<div id="outline-container-org8d24847" class="outline-3">
<h3 id="org8d24847">Imágenes desde URLs</h3>
<div class="outline-text-3" id="text-org8d24847">
<p>
Las imágenes desde URLs son más fáciles de menejar. Lo único que tenemos que hacer es crear un enlace al URL y listo. Por ejemplo, el siguiente enlace:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #00bcff; text-decoration: underline;"><a href="https://www.nasa.gov/sites/default/files/thumbnails/image/main_image_deep_field_smacs0723-5mb.jpg">https://www.nasa.gov/sites/default/files/thumbnails/image/main_image_deep_field_smacs0723-5mb.jpg</a></span>
</pre>
</div>

<p>
Nos muestra la siguiente imagen:
</p>


<figure id="org0d21ab5">
<img src="https://www.nasa.gov/sites/default/files/thumbnails/image/main_image_deep_field_smacs0723-5mb.jpg" alt="main_image_deep_field_smacs0723-5mb.jpg">

</figure>
</div>
</div>

<div id="outline-container-org21e04e3" class="outline-3">
<h3 id="org21e04e3">Gráficas de Tikz</h3>
<div class="outline-text-3" id="text-org21e04e3">
<p>
<a href="https://tikz.dev/"><code>Tikz</code></a> es un paquete de LaTex que permite crear diagramas y gráficas complejas con un lenguaje de marcado. Es muy utilizado en documentos técnicos y publicaciones académicas. Si bien tiene una curva de aprendizaje alta, hay que cosas que serían mucho más complejas de hacer de cualquier otra forma. En adición, al ser un lenguaje de marcado, la modificación de las imágenes es simple. 
</p>

<p>
<code>org-mode</code> y <code>babel</code> tienen soporte nativo para LaTex, lo que nos permite incluir bloques de código LaTex (con una imagen <code>tikz</code>) y mostrar el resultado como imagen. Sin embargo, para lograrlo tenemos que tener instalado el paquete <code>imagemagick</code> en nuestros computadores. Esta instalación depende de su sistema operativo, así que no será cubierta en esta nota. En adición, hay que activar LaTex en <code>babel</code> incluyendo el siguiente código en nuestra configuración de Emacs:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #ffffff;">(</span>org-babel-do-load-languages 'org-babel-load-languages
                             <span style="color: #ff62d4;">(</span>append org-babel-load-languages
                                     '<span style="color: #3fdfd0;">(</span><span style="color: #fba849;">(</span>latex . t<span style="color: #fba849;">)</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
Ya podemos incluir bloques de código LaTex, incluyendo figuras Tikz, como se muestra a continuación
</p>

<pre class="example" id="orgbca1fdb">
#+name: tutorial
#+header: :exports results :file media/test.png
#+header: :results file raw :border 0cm
#+header: :imagemagick t
#+header: :headers '("\\usepackage{tikz} \\usetikzlibrary{positioning, shapes.symbols, calc}")
#+begin_src latex
  \begin{tikzpicture}
    \fill[blue!40!red] (0,0) rectangle (1,1);
  \end{tikzpicture}
#+end_src
</pre>


<figure id="org0fd12de">
<img src="media/test.png" alt="test.png">

</figure>

<p>
Este bloque de código tiene muchas etiquetas de configuración, que explicaremos a continuación.
</p>

<ul class="org-ul">
<li><code>#+name:</code> es el nombre de la figura. No tiene mayor efecto en generación de archivos html.</li>
<li><code>#+header:</code> son los parámetros usados al momento de ejecutar el código LaTex.
<ul class="org-ul">
<li><code>:exports results</code> nos dice que se va a exportar el resultado de ejecutar el bloque de código pero no el código. Otras opciones para este parámetro son <code>none</code> para no exportar ni código ni resultado, <code>code</code> para exportar el código, o <code>both</code> para exportar código y resultado de ejecución.</li>
<li><code>:file</code> es la ruta en donde se va a guardar la imagen generada. Dada la configuración que hemos realizado con <code>org-publish-project-alist</code>, estas imágenes deben guardarse en la carpeta <code>contenido/media</code>.</li>
<li><code>:results file raw</code> indica que el contenido es un enlace a archivo y se debe mostrar sin encerrarse en ningún bloque específico. Otras opciones para este parámetro se encuentran en el <a href="https://orgmode.org/manual/Results-of-Evaluation.html">manual de org-mode</a>, aunque no son muy relevantes para lo que estamos haciendo.</li>
<li><code>:border 0cm</code> indica que la figura no debe tener ningún borde.</li>
<li><code>:imagemagick t</code> se usa cuando queremos exportar a formatos distintos a <code>.pdf</code>. Es necesario para publicación de sitos web.</li>
<li><code>:headers</code> es una lista en donde se especifica el preámbulo de LaTex para la ejecución del código. Es necesario incluir los paquetes de LaTex que se van a utilizar (no olvidar <code>tikz</code>) y las librerías de Tikz que necesitemos.</li>
<li>Existen otras opciones descritas en el <a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-LaTeX.html">manual de org-mode</a>.</li>
</ul></li>
</ul>

<p>
Si vamos a utilizar muchas imágenes de Tikz en el mismo documento, podemos factorizar esta definición personalizando la variable <code>org-babel-default-header-args:latex</code> con los valores por defecto de la equiteta <code>#+header</code>. Esto se puede hacer para carpetas completas con la respectiva definición en <code>.dir-locals.el</code> o por archivo incluyendo la siguiente línea <b>como primera línea del archivo <code>.org</code></b>:
</p>

<pre class="example" id="orgba83dac">
# -*- eval: (setq org-babel-default-header-args:latex '((:results . "file raw") (:exports . "results") (:border . "0cm") (:headers . "\\usepackage{tikz} \\usetikzlibrary{positioning, shapes.symbols") (:imagemagick . "t"))) -*-
</pre>

<p>
Con esta configuración, nuestro bloque de código ahora se verá así:
</p>
<pre class="example" id="org986a4d4">
#+name: tutorial
#+header: :file media/test.png
#+begin_src latex
  \begin{tikzpicture}
    \fill[blue!40!red] (0,0) rectangle (1,1);
  \end{tikzpicture}
#+end_src
</pre>

<p>
Con esto se aplicarán todas las opciones incluidas en el código anterior a todas los bloques de LaTex que se incluyan en nuestro archivo <code>.org</code>. Si para algún caso específico requerimos modificar algún parámetro en específico, sólo tenemos que agregarla al bloque y este valor tendrá precedencia sobre los definidos en <code>org-babel-default-header-args:latex</code>. 
</p>
</div>
</div>

<div id="outline-container-org76f982b" class="outline-3">
<h3 id="org76f982b">Parámetros de imágenes</h3>
<div class="outline-text-3" id="text-org76f982b">
<p>
Algunas plantilla de css ayudan mucho a controlar el aspecto visual de las imágenes. <a href="https://simplecss.org/">Simple.css</a>, por ejemplo, controla el tamaño máximo de las imágenes que son demasiado grandes. Sin embargo, si queremos tener un control más preciso de las imágenes, o si no usamos un plantilla de css con estas capacidades, podemos usar la etiqueta <code>#+attr_html:</code> encima del enlace a nuestra imagen de la siguiente forma:
</p>

<pre class="example" id="orgb141b6e">
#+attr_html: :width 10% :title Título de la imagen :parametro valor
[[file:media/nasa.jpg]]
</pre>

<p>
Esto nos mostrará lo siguiente:
</p>


<figure id="org8a0e23c">
<img src="media/nasa.jpg" alt="nasa.jpg" width="10%" title="Título de la imagen" parametro="valor">

</figure>

<p>
Con esto se pueden establecer parámetros como el tamaño o el título de la imagen, pero también se puede definir cualquier parámetro de html como se ve al final de la línea <code>#+attr_html</code> del ejemplo anterior.
</p>

<p>
Si queremos tener este tipo de control con imágenes o gráficas generadas por Tikz, tenemos que definirla con <code>:exports none</code> y crear un enlace normal a la imagen producida.
</p>

<p>
Finalmente, agregando la línea <code>#+caption: Descripción de la imagen</code> sobre cualquiera de nuestras imágenes, obtendremos un etiquetado de nuestras imágenes con numeración automática. Sin embargo, la forma en la que <code>org-mode</code> exporta esto es algo rudimentaria y no hace uso de elementos HTML5 como las etiquetas <code>figure</code> y <code>figcaption</code>. Para resolverlo, tenemos que personalizar las variables <code>org-html-html5-fancy</code> y <code>org-html-doctype</code>. Esto se puede hacer en nuestra definición de <code>org-publish-project-alist</code> de la siguiente forma:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #ffffff;">(</span><span style="color: #ff62d4;">(</span>nil . <span style="color: #3fdfd0;">(</span><span style="color: #fba849;">(</span>eval . <span style="color: #9f80ff;">(</span><span style="color: #b6a0ff;">setq</span> org-publish-project-alist 
                       <span style="color: #4fe42f;">(</span>list
                        <span style="color: #fe6060;">(</span>list <span style="color: #79a8ff;">"verborrea"</span>
                              <span style="color: #f78fe7;">:recursive</span> t
                              <span style="color: #f78fe7;">:base-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"contenido"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:publishing-directory</span> <span style="color: #4fafff;">(</span>concat <span style="color: #f0dd60;">(</span>projectile-project-root<span style="color: #f0dd60;">)</span> <span style="color: #79a8ff;">"docs"</span><span style="color: #4fafff;">)</span>
                              <span style="color: #f78fe7;">:publishing-function</span> 'org-html-publish-to-html
                              <span style="color: #f78fe7;">:with-author</span> t
                              <span style="color: #f78fe7;">:with-creator</span> t
                              <span style="color: #f78fe7;">:with-toc</span> nil
                              <span style="color: #f78fe7;">:time-stamp-file</span> nil
                              <span style="color: #f78fe7;">:html-validation-link</span> nil
                              <span style="color: #f78fe7;">:html-link-home</span> <span style="color: #79a8ff;">"index.html"</span>
                              <span style="color: #f78fe7;">:html-head-include-default-style</span> nil
                              <span style="color: #f78fe7;">:html-head-include-scripts</span> nil
                              <span style="color: #f78fe7;">:html-head</span> <span style="color: #79a8ff;">"&lt;link rel=\"stylesheet\" href=\"https://cdn.simplecss.org/simple.min.css\" /&gt;"</span>
                              <span style="color: #f78fe7;">:section-numbers</span> nil
                              <span style="color: #f78fe7;">:language</span> <span style="color: #79a8ff;">"es"</span>
                              <span style="color: #f78fe7;">:html-html5-fancy</span> t
                              <span style="color: #f78fe7;">:html-doctype</span> <span style="color: #79a8ff;">"html5"</span><span style="color: #fe6060;">)</span><span style="color: #4fe42f;">)</span><span style="color: #9f80ff;">)</span><span style="color: #fba849;">)</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
Note que no sólo establecimos valores para <code>html-html5-fancy</code> y <code>html-doctype</code>, sino que también definimos el lenguaje como <code>es</code> para que se usen nombres en español para los rótulos de las imágenes.
</p>

<p>
Ahora, el siguiente bloque nos muestra imágenes con descripción usando la etiqueta <code>figcaption</code> de HTML5:
</p>


<figure id="org7f8b99e">
<img src="media/nasa.jpg" alt="nasa.jpg">

<figcaption><span class="figure-number">Figura 1: </span>Créditos: NASA, ESA, CSA, y STScI.  Tomada de <a href="https://www.nasa.gov/webbfirstimages">https://www.nasa.gov/webbfirstimages</a></figcaption>
</figure>
</div>
</div>
</div>

<div id="outline-container-org9b64525" class="outline-2">
<h2 id="org9b64525">Inclusión de formulas matemáticas</h2>
<div class="outline-text-2" id="text-org9b64525">
</div>
<div id="outline-container-org29366a0" class="outline-3">
<h3 id="org29366a0">Dos métodos para mostrar contenido matemático</h3>
<div class="outline-text-3" id="text-org29366a0">
<p>
El <a href="https://orgmode.org/manual/Math-formatting-in-HTML-export.html">manual de <code>org-mode</code></a> nos habla de dos formas de mostrar contenido matemático: procesar fórmulas en formato TeX y convertirlas a imágenes, o usar <a href="https://www.mathjax.org/">MathJax</a>. Si bien el método de las imágenes es efectivo, tiene problemas con la ubicación de las imágenes y no tiene tantas funcionalidades como MathJax. Siendo así, esta nota se centrará en el uso de MathJax.
</p>
</div>
</div>

<div id="outline-container-orga0475d8" class="outline-3">
<h3 id="orga0475d8">Formulas en línea</h3>
<div class="outline-text-3" id="text-orga0475d8">
<p>
El primer tipo de fórmulas que vamos a ver son fórmulas en línea. Estas son fórmulas que fluyen con el texto como \(x²+y²=0\). Éstas se logran poniendo la fórmula (en sintaxis LaTex) entre los delimitadores <code>\( \)</code> dentro de un párrafo. Podría también usarse los delimitadores <code>$ $</code>, pero el manual de MathJax no lo recomienda ya que el símbolo <code>$</code> puede usarse para otros fines dentro de un texto y esto puede generar errores a la hora de mostrar el contenido.
</p>
</div>
</div>

<div id="outline-container-org8e49196" class="outline-3">
<h3 id="org8e49196">Formulas independientes</h3>
<div class="outline-text-3" id="text-org8e49196">
<p>
Para formulas que queramos tener independientes o numeradas, se deben usar los delimitadores <code>$$ $$</code>. Por ejemplo, la siguiente línea
</p>

<pre class="example" id="org9319680">
$$x+1\over\sqrt{1-x^2}\label{ref1}$$
</pre>

<p>
Nos genera la siguiente ecuación:
</p>

<p>
\[x+1\over\sqrt{1-x^2}\label{ref1}\]
</p>
</div>

<div id="outline-container-org5713393" class="outline-4">
<h4 id="org5713393">Numeración</h4>
<div class="outline-text-4" id="text-org5713393">
<p>
Es importante anotar que Emacs no numera las ecuaciones por defecto. Para obtener esta numeración tenemos que activarla agregando la siguiente línea al inicio del archivo <code>.org</code> a exportar:
</p>

<pre class="example" id="org289c30b">
#+html_mathjax: autonumber: all
</pre>

<p>
También podemos personalizar la variable <code>org-html-mathjax-options</code> si queremos que esto aplique para todos los archivos que exportemos. Finalmente, también podemos agregarla a nuestro archivo <code>.dir-locals.el</code> si queremos que aplique para todos los archivos de nuestro proyecto, pero sin que se tenga en cuenta para archivos por fuera de éste.
</p>

<p>
Si por algún motivo queremos queremos hacer referencia a la primera ecuación \ref{ref1}, lo podemos hacer usando:
</p>

<pre class="example" id="orgb343bbd">
\ref{ref1}
</pre>

<p>
Ahora, si por algún motivo queremos incluir una fórmula sin numeración, tenemos que agregar =\nonumber al final de la fórmula: 
</p>

<pre class="example" id="org61937c7">
$$x+1\over\sqrt{1-x^2}\nonumber$$
</pre>

<p>
\[x+1\over\sqrt{1-x^2}\nonumber\]
</p>
</div>
</div>

<div id="outline-container-org85a897e" class="outline-4">
<h4 id="org85a897e">Ambientes LaTex</h4>
<div class="outline-text-4" id="text-org85a897e">
<p>
Una de las mejores funcionalidades de MathJax es que permite la inclusión de ambientes de ecuaciones de LaTex. Por ejemplo, el siguiente código en un archivo <code>.org</code>
</p>

<pre class="example" id="org1137fee">
\begin{align} 
x&amp; = y_1-y_2+y_3-y_5+y_8-\dots &amp;&amp; \text{por \eqref{ref1}}\\ 
&amp; = y'\circ y^* &amp;&amp; \text{por definición}\\ 
&amp; = y(0) y' &amp;&amp; \text {por Axioma 1.} 
\end{align} 
</pre>

<p>
Produce:
</p>

\begin{align} 
x& = y_1-y_2+y_3-y_5+y_8-\dots && \text{por \eqref{ref1}}\\ 
& = y'\circ y^* && \text{por definición}\\ 
& = y(0) y' && \text {por Axioma 1.} 
\end{align} 

<p>
Como ven, las posibilidades de exportar contenido matemático con MathJax son muchas gracias al soporte que tiene de ambientes matemáticos LaTex. El <a href="http://docs.mathjax.org/en/latest/index.html">manual de MathJax</a> ofrece mucha más información como extensiones y opciones de interacción.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org99e1088" class="outline-2">
<h2 id="org99e1088">Cierre</h2>
<div class="outline-text-2" id="text-org99e1088">
<p>
Ya está. Ya puede crear un sitio web básico y con buen diseño web sin mayores conocimientos en <code>html</code>, <code>css</code>, o <code>js</code>. La forma más fácil de publicar esto es usando el servicio de <a href="http://github.io">http://github.io</a>, pero eso está por fuera del objetivo de esta nota.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Notas al pie de p&aacute;gina: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Esta carpeta puede tener cualquier nombre, pero nombrarla <code>docs</code> facilitará la publicación en <a href="http://github.io">http://github.io</a>. 
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="date">Fecha: 2022:07:10</p>
<p class="author">Autor: Juan E. Gómez-Morantes</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.5.2)</p>
</div>
</body>
</html>
